import React, { useState, useEffect } from 'react';
import axios from 'axios';

const {{ component.name }}{{ view }} = ({ onEdit, onDelete, id }) => {
    const [data, setData] = useState([]);
    const [formData, setFormData] = useState({});
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        if ("{{ view }}" === "List") {
            axios.get('/api/{{ component.name | lower }}s')
                .then(response => {
                    setData(response.data);
                    setLoading(false);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    setError(error);
                    setLoading(false);
                });
        } else if ("{{ view }}" === "Form" && id) {
            axios.get(`/api/{{ component.name | lower }}s/${id}`)
                .then(response => {
                    setFormData(response.data);
                    setLoading(false);
                })
                .catch(error => {
                    console.error('Error fetching form data:', error);
                    setError(error);
                    setLoading(false);
                });
        } else {
            setLoading(false);
        }
    }, [id]);

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData({
            ...formData,
            [name]: value,
        });
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        const method = id ? 'put' : 'post';
        const url = id
            ? `/api/{{ component.name | lower }}s/${id}`
            : `/api/{{ component.name | lower }}s`;

        axios[method](url, formData)
            .then(response => {
                console.log('Data saved successfully:', response.data);
            })
            .catch(error => {
                console.error('Error saving data:', error);
                setError(error);
            });
    };

    if (loading) return <div>Loading...</div>;
    if (error) return <div>Error: {error.message}</div>;

    return (
        <div>
            {% if view == 'List' %}
            <ul>
                {data.map(item => (
                    <li key={item.id}>
                        {item.name} {/* Replace with appropriate field */}
                        <button onClick={() => onEdit(item)}>Edit</button>
                        <button onClick={() => onDelete(item.id)}>Delete</button>
                    </li>
                ))}
            </ul>
            {% elif view == 'Form' %}
            <form onSubmit={handleSubmit}>
                {{ component.fields | tojson }}.map((field) => (
                    <div key={field.name}>
                        <label htmlFor={field.name}>{field.name}</label>
                        <input
                            type={field.type}
                            id={field.name}
                            name={field.name}
                            value={formData[field.name] || ''}
                            onChange={handleInputChange}
                        />
                    </div>
                ))}
                <button type="submit">{id ? 'Update' : 'Create'}</button>
            </form>
            {% elif view == 'Detail' %}
            <div>
                {Object.keys(data).map(key => (
                    <p key={key}>
                        <strong>{key}:</strong> {data[key]}
                    </p>
                ))}
            </div>
            {% endif %}
        </div>
    );
};

export default {{ component.name }}{{ view }};
